<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>BusWebApp</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- If you add any scoped CSS files, uncomment the following to load them
    <link href="BusWebApp.styles.css" rel="stylesheet" /> -->

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js'
       import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCcFciQPeqJkfEE7sCyAbw7n27eN37NQII",
            authDomain: "buswebapp-af615.firebaseapp.com",
            databaseURL: "https://buswebapp-af615-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "buswebapp-af615",
            storageBucket: "buswebapp-af615.appspot.com",
            messagingSenderId: "306358606133",
            appId: "1:306358606133:web:317fe64804f3e7ac91547c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(); 

        const BuyTicket = () => {
            
            const database = getDatabase(app);
            try {
                const reference = ref(database, 'tickets/' + `${auth.currentUser.uid}`);

                set(reference, {
                    ticketNumber: "s",
                    discount: ""
                });
                console.log("Bilet kupiony");
                document.getElementById("TicketSuccess").classList.remove('d-none');
                document.getElementById("TicketError").classList.add('d-none');
            }
            catch(error){
                document.getElementById("TicketSuccess").classList.add('d-none');
                document.getElementById("TicketError").classList.remove('d-none');
                console.log(error.code);
            }

        }

        const LogIn = async () => {
            const login = document.getElementById("LoginEmail").value;
            const password = document.getElementById("LoginPassword").value;
            try {
                const userCredential = await signInWithEmailAndPassword(auth, login, password)
                console.log(userCredential.user);
                document.getElementById("LoginError").classList.add('d-none');
                document.getElementById("LoginSuccess").classList.remove('d-none');
            } catch (error) {
                console.log(error.code);
                document.getElementById("LoginError").classList.remove('d-none');
                document.getElementById("LoginSuccess").classList.add('d-none');
            }

        }

        const LogOut = async () => {
            await signOut(auth);
        }

        document.addEventListener("click", function (event) {
            if (event.target.matches('.button-buy-ticket')) {
                BuyTicket();
            }
            else if (event.target.matches('.button-log-in')) {
                console.log("logowanie");
                LogIn();
            }
            else if (event.target.matches('.button-log-out')) {
                console.log("wylogowanie");
                LogOut();
            }
        });
    </script>
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
</body>

</html>
